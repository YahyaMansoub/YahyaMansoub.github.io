<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Car Management</title>
		<link rel="stylesheet" href="global-styles.css">
			<style>
				/* Mobile-first variables and base styles */
				:root{--bg:#f6f8fa;--card:#fff;--accent:#1e88e5;--danger:#e53935}
				*{box-sizing:border-box}
				html,body{height:100%}
				body{font-family:Segoe UI, Roboto, Arial, sans-serif;margin:0;background:var(--bg);color:#111;-webkit-font-smoothing:antialiased}

				/* Navbar: sticky and touch friendly */
				.navbar{background:#24292f;color:#fff;padding:14px 16px;display:flex;align-items:center;gap:10px;position:sticky;top:0;z-index:40}
				.navbar a{color:#fff;text-decoration:none;font-weight:700;font-size:16px}

				/* Container centered, with comfortable padding on small screens */
				.container{max-width:720px;margin:12px auto;padding:12px}
				.card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(16,24,40,.06)}

				/* Center column layout */
				.center{display:flex;flex-direction:column;align-items:center;gap:12px}
				/* square image for consistent presentation on phones */
				.car-img{width:100%;max-width:420px;aspect-ratio:1/1;object-fit:cover;border-radius:8px;border:1px solid #eee}

				/* Buttons: stacked and full-width on mobile for easy tapping */
				.btn-row{display:flex;flex-direction:column;gap:10px;width:100%}
				.btn{background:var(--accent);color:#fff;border:none;padding:14px;border-radius:10px;cursor:pointer;font-weight:700;font-size:16px}
				.btn.secondary{background:#6c757d}

				/* Calendar: responsive grid; smaller day tiles on mobile */
				.calendar{width:100%;margin-top:18px}
				.month{display:flex;justify-content:space-between;align-items:center;padding:8px 0}
				.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
				.day{background:#fff;padding:8px;border-radius:8px;text-align:center;min-height:58px;box-shadow:0 1px 3px rgba(0,0,0,.04);font-size:14px}
				.day.busy{background:linear-gradient(90deg, rgba(229,57,53,.06), rgba(229,57,53,.02));border:1px solid rgba(229,57,53,.12)}
				.day.sunday{color:#d32f2f}

				/* History: stacked items for small screens */
				.history{margin-top:18px}
				.history-item{display:flex;flex-direction:row;justify-content:space-between;align-items:center;padding:12px;border-radius:10px;background:#fff;margin-bottom:10px;gap:10px}
				.history-item > div:first-child{flex:1;word-break:break-word}
				.download{background:#0b6623;color:#fff;padding:10px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:700}

				/* Larger hit areas for small screens */
				button{touch-action:manipulation}

				/* Medium+ screens: show buttons side-by-side and slightly larger layout */
				@media (min-width:560px){
					.btn-row{flex-direction:row}
					.btn{flex:1}
					.container{padding:18px}
				}

				/* Desktop: keep it tidy */
				@media (min-width:980px){
					.container{max-width:980px}
				}
			</style>
	</head>
	<body>
		<header class="navbar">
			<a href="main.html">← Back</a>
			<div style="font-weight:700">Car Management</div>
		</header>

		<main class="container">
			<section class="card center">
				<!-- Centered car image -->
				<img src="car.jpeg" alt="Car" class="car-img" onerror="this.onerror=null;this.src='https://via.placeholder.com/420x420?text=Car+Image'"/>

				<!-- Buttons -->
				<div class="btn-row">
					<button class="btn" id="revenueBtn">Revenue Statistics</button>
					<button class="btn secondary" id="costBtn">Cost Maintenance</button>
					<button class="btn" id="addResBtn">Add Reservation</button>
				</div>

				<!-- Calendar -->
				<div class="calendar card" style="width:100%;margin-top:18px">
					<div class="month">
						<div style="font-weight:700">October 2025</div>
						<div style="color:#666">Select a day</div>
					</div>
					<div class="grid" id="calendarGrid">
						<!-- Weekday headers -->
						<div class="day"><strong>Sun</strong></div>
						<div class="day"><strong>Mon</strong></div>
						<div class="day"><strong>Tue</strong></div>
						<div class="day"><strong>Wed</strong></div>
						<div class="day"><strong>Thu</strong></div>
						<div class="day"><strong>Fri</strong></div>
						<div class="day"><strong>Sat</strong></div>
						<!-- days will be injected by JS -->
					</div>
				</div>

				<!-- History (static entries so list is always visible) -->
				<div class="history card" style="width:100%;margin-top:18px">
					<h3 style="margin:0 0 8px 0">History</h3>
					<div id="historyList">
						<!-- Static example entries -->
						<div class="history-item">
							<div>
								<div style="font-weight:700">Alice Dupont</div>
								<div style="font-size:12px;color:#666">2025-10-02</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for Alice Dupont
	Vehicle ID: ABC123
	Date: 2025-10-02</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
						<div class="history-item">
							<div>
								<div style="font-weight:700">Mohamed Salah</div>
								<div style="font-size:12px;color:#666">2025-09-15</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for Mohamed Salah
	Vehicle ID: ABC123
	Date: 2025-09-15</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
						<div class="history-item">
							<div>
								<div style="font-weight:700">Sofia Martinez</div>
								<div style="font-size:12px;color:#666">2025-08-30</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for Sofia Martinez
	Vehicle ID: ABC123
	Date: 2025-08-30</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
						<div class="history-item">
							<div>
								<div style="font-weight:700">John Smith</div>
								<div style="font-size:12px;color:#666">2025-07-21</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for John Smith
	Vehicle ID: ABC123
	Date: 2025-07-21</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
						<div class="history-item">
							<div>
								<div style="font-weight:700">Lina Chen</div>
								<div style="font-size:12px;color:#666">2025-06-10</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for Lina Chen
	Vehicle ID: ABC123
	Date: 2025-06-10</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
						<div class="history-item">
							<div>
								<div style="font-weight:700">Brahim Anouar</div>
								<div style="font-size:12px;color:#666">2025-05-05</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for Brahim Anouar
	Vehicle ID: ABC123
	Date: 2025-05-05</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
						<div class="history-item">
							<div>
								<div style="font-weight:700">Othmane Benahmed</div>
								<div style="font-size:12px;color:#666">2025-04-12</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for Othmane Benahmed
	Vehicle ID: ABC123
	Date: 2025-04-12</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
						<div class="history-item">
							<div>
								<div style="font-weight:700">Yahya Benjelloun</div>
								<div style="font-size:12px;color:#666">2025-03-08</div>
							</div>
							<div>
								<pre class="contract" style="display:none">Contract for Yahya Benjelloun
	Vehicle ID: ABC123
	Date: 2025-03-08</pre>
								<button class="download">Download Contract</button>
							</div>
						</div>
					</div>
				</div>
			</section>
		</main>

		<script>
			// Button handlers (placeholders)
			document.getElementById('revenueBtn').addEventListener('click', ()=>{
				alert('Revenue statistics - implement navigation or chart here.')
			})
			document.getElementById('costBtn').addEventListener('click', ()=>{
				alert('Cost maintenance - implement form or details here.')
			})
					document.getElementById('addResBtn').addEventListener('click', ()=>{
						window.location.href = 'reservation.html'
					})

			// Build October 2025 calendar and mark Oct 1-4 busy
			(function buildCalendar(){
				const grid = document.getElementById('calendarGrid')
				// October 2025: 1st is Wednesday
				const year = 2025, month = 9 // 0-indexed (September=8), October=9
				const first = new Date(year, month, 1)
				const daysInMonth = new Date(year, month+1, 0).getDate()

				// Determine weekday index (0=Sun..6=Sat) of the 1st
				const startWeekday = first.getDay()

				// Add blank days for previous month
				for(let i=0;i<startWeekday;i++){
					const blank = document.createElement('div')
					blank.className='day'
					blank.innerHTML=''
					grid.appendChild(blank)
				}

				for(let d=1; d<=daysInMonth; d++){
					const cell = document.createElement('div')
					cell.className='day'
					if((d===1)||(d===2)||(d===3)||(d===4)){
						cell.classList.add('busy')
						cell.innerHTML=`<div style="font-weight:700">${d}</div><div style="color:var(--danger);font-size:12px">Busy</div>`
					} else {
						cell.innerHTML=`<div style="font-weight:700">${d}</div>`
					}
					grid.appendChild(cell)
				}
			})()

			// History entries with download button for contract
			(function buildHistory(){
		    const history = document.getElementById('historyList')
		    // start with built-in example entries
		    const entries = [
					{name:'Alice Dupont', date:'2025-10-02', contractText:'Contract for Alice Dupont\nVehicle ID: ABC123\nDate: 2025-10-02'},
					{name:'Mohamed Salah', date:'2025-09-15', contractText:'Contract for Mohamed Salah\nVehicle ID: ABC123\nDate: 2025-09-15'},
					{name:'Sofia Martinez', date:'2025-08-30', contractText:'Contract for Sofia Martinez\nVehicle ID: ABC123\nDate: 2025-08-30'},
					{name:'John Smith', date:'2025-07-21', contractText:'Contract for John Smith\nVehicle ID: ABC123\nDate: 2025-07-21'},
					{name:'Lina Chen', date:'2025-06-10', contractText:'Contract for Lina Chen\nVehicle ID: ABC123\nDate: 2025-06-10'},
					{name:'Brahim Anouar', date:'2025-05-05', contractText:'Contract for Brahim Anouar\nVehicle ID: ABC123\nDate: 2025-05-05'},
					{name:'Othmane Benahmed', date:'2025-04-12', contractText:'Contract for Othmane Benahmed\nVehicle ID: ABC123\nDate: 2025-04-12'},
					{name:'Yahya Benjelloun', date:'2025-03-08', contractText:'Contract for Yahya Benjelloun\nVehicle ID: ABC123\nDate: 2025-03-08'}
				]

			// Clear the history list first
			history.innerHTML = ''

			// Load reservations from localStorage (if any) and prepend them
			try{
				const saved = JSON.parse(localStorage.getItem('locaflotte_reservations') || '[]')
				// map saved reservations to history-like entries
				const savedEntries = saved.map(r=>({name:r.name, date:r.start+ (r.end? ' → ' + r.end : ''), contractText:`Reservation for ${r.name}\nStart: ${r.start}\nEnd: ${r.end}\nNotes: ${r.notes}`}))
				// newest first
				entries.unshift(...savedEntries)
			}catch(e){/* ignore malformed storage */}

			if(entries.length === 0){
				const empty = document.createElement('div')
				empty.style.padding = '12px'
				empty.style.color = '#666'
				empty.textContent = 'No history yet.'
				history.appendChild(empty)
				return
			}

			entries.forEach((e, idx)=>{
				const item = document.createElement('div')
				item.className='history-item'
				item.innerHTML = `<div><div style="font-weight:700">${e.name}</div><div style="font-size:12px;color:#666">${e.date || ''}</div></div>`
				const dl = document.createElement('button')
				dl.className='download'
				dl.textContent='Download Contract'
				dl.addEventListener('click', ()=>{
					// if entry has a contract data URL (from reservation), download it directly
					if(e.contract && e.contract.startsWith('data:')){
						const a = document.createElement('a')
						a.href = e.contract
						// try to keep original filename extension
						a.download = `${(e.name||'contract').replace(/\s+/g,'_')}_contract.pdf`
						document.body.appendChild(a)
						a.click()
						a.remove()
						return
					}

					// otherwise create a text contract
					const blob = new Blob([e.contractText || ('Contract for '+e.name)],{type:'text/plain'})
					const url = URL.createObjectURL(blob)
					const a = document.createElement('a')
					a.href = url
					a.download = `${(e.name||'contract').replace(/\s+/g,'_')}_contract.txt`
					document.body.appendChild(a)
					a.click()
					a.remove()
					URL.revokeObjectURL(url)
				})
				item.appendChild(dl)
				history.appendChild(item)
			})
			})()
		</script>
	</body>
</html>
