<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Add Reservation - CarLand</title>
    <link rel="stylesheet" href="global-styles.css">
  </head>
  <body>
    <header class="navbar">
      <a href="car_management.html">‚Üê Back</a>
      <div style="font-weight:700">Add Reservation</div>
    </header>

    <main class="container">
      <section class="card">
        <form id="resForm">
          <div class="form-group">
            <label class="form-label" for="name">Customer Name *</label>
            <input class="form-control" id="name" name="name" required placeholder="Enter customer name" />
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label class="form-label" for="start">Start Date *</label>
              <input class="form-control" id="start" name="start" type="date" required />
            </div>
            <div class="form-group">
              <label class="form-label" for="end">End Date *</label>
              <input class="form-control" id="end" name="end" type="date" required />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="notes">Additional Notes</label>
            <textarea class="form-control" id="notes" name="notes" rows="4" placeholder="Enter any special requirements or notes"></textarea>
          </div>

          <div class="form-group">
            <label class="form-label" for="contractFile">Attach Contract (PDF)</label>
            <input class="form-control" id="contractFile" name="contractFile" type="file" accept="application/pdf" />
          </div>

          <div style="display:flex;gap:12px;margin-top:25px;">
            <button type="submit" class="btn success">Save Reservation</button>
            <a href="car_management.html" class="btn secondary">Cancel</a>
          </div>
        </form>
      </section>
    </main>

    <script>
      const form = document.getElementById('resForm')
      form.addEventListener('submit', async (e)=>{
        e.preventDefault()
        const name = document.getElementById('name').value.trim()
        const start = document.getElementById('start').value
        const end = document.getElementById('end').value
        const notes = document.getElementById('notes').value.trim()
        const fileInput = document.getElementById('contractFile')

        if(!name || !start || !end){
          alert('Please fill required fields')
          return
        }

        let contractDataUrl = null
        if(fileInput && fileInput.files && fileInput.files[0]){
          const file = fileInput.files[0]
          // read as data URL
          contractDataUrl = await new Promise((res, rej)=>{
            const reader = new FileReader()
            reader.onload = ()=>res(reader.result)
            reader.onerror = (err)=>rej(err)
            reader.readAsDataURL(file)
          })
        }

        const reservation = {id:Date.now(), name, start, end, notes, contract: contractDataUrl}
        const key = 'locaflotte_reservations'
        const existing = JSON.parse(localStorage.getItem(key) || '[]')
        existing.unshift(reservation)
        localStorage.setItem(key, JSON.stringify(existing))

        // navigate back to car page after save
        window.location.href = 'car_management.html'
      })
    </script>
  </body>
</html>
